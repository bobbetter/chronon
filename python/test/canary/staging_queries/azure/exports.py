from ai.chronon.staging_query import EngineType, StagingQuery, TableDependency


def get_select_star_export(table: str, partition_column: str = "ds"):
    snowflake_export_sql = f"""
    SELECT
        *
    FROM {table}
    WHERE
    DATE_TRUNC('DAY', {partition_column}) BETWEEN {{{{ start_date }}}} AND {{{{ end_date }}}}
    """

    return StagingQuery(
        query=snowflake_export_sql,
        output_namespace="data",
        engine_type=EngineType.SNOWFLAKE,
        dependencies=[
            TableDependency(table=f"{table}", partition_column=partition_column, offset=0)
        ],
        version=0,
    )


def get_native_partition_export(table: str, partition_column: str):
    snowflake_partition_sql = f"""
    SELECT
        *,
        DATE_TRUNC('DAY', {partition_column}) as ds
    FROM {table}
    WHERE
    {partition_column} BETWEEN {{{{ start_date }}}} AND {{{{ end_date }}}}
    """
    return StagingQuery(
        query=snowflake_partition_sql,
        output_namespace="data",
        engine_type=EngineType.SNOWFLAKE,
        dependencies=[
            TableDependency(table=f"{table}", partition_column=partition_column, offset=0)
        ],
        version=0,
    )



user_activities = get_native_partition_export("user_activities", "ds")
checkouts = get_native_partition_export("checkouts", "ds")
dim_listings = get_select_star_export("dim_listings", "ds")
dim_merchants = get_select_star_export("dim_merchants", "ds")
dim_users = get_select_star_export("dim_users", "ds")
